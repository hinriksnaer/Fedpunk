# Autostart Applications
# Programs to run on Hyprland startup

# Essential services first
# Import all critical Wayland/toolkit environment variables into systemd user session
# This ensures systemd user services (like elephant, pipewire) have proper Wayland support
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE XDG_SESSION_DESKTOP GDK_BACKEND QT_QPA_PLATFORM SDL_VIDEODRIVER CLUTTER_BACKEND MOZ_ENABLE_WAYLAND QT_AUTO_SCREEN_SCALE_FACTOR QT_WAYLAND_DISABLE_WINDOWDECORATION QT_QPA_PLATFORMTHEME
exec-once = hyprpolkitagent
exec-once = dunst

# Walker application launcher service
# Started via exec-once (not systemd) to ensure Wayland compositor is fully ready
# Must use GDK_BACKEND=wayland (not wayland,x11) to avoid Wayland compositor connection issues
exec-once = sleep 2 && GDK_BACKEND=wayland walker --gapplication-service

# Wallpaper with fallbacks
# 1. Try current theme wallpaper
# 2. Fall back to default solid color if theme fails
exec-once = bash -c 'if [[ -f ~/.config/hypr/wallpapers/current ]]; then swaybg -i ~/.config/hypr/wallpapers/current -m fill; else fallback_wp=$(find ~/.local/share/fedpunk/themes/*/backgrounds -name "*.jpg" -o -name "*.png" | head -1 2>/dev/null); if [[ -f "$fallback_wp" ]]; then swaybg -i "$fallback_wp" -m fill; else swaybg -c "#1e1e1e"; fi; fi'

# Network management
exec-once = nm-applet

# Emergency terminal access (hidden by default, Super+Shift+Return to show)
# This provides a way to debug if the system becomes unresponsive
exec-once = [workspace special:emergency] kitty --title="Emergency Terminal"

# Initialize default theme if none exists, then apply theme
exec-once = sleep 2 && bash -c 'if [[ ! -f ~/.config/kitty/theme.conf ]]; then ~/.local/share/fedpunk/bin/fedpunk-theme-set default 2>/dev/null || true; fi; ~/.local/share/fedpunk/bin/fedpunk-theme-refresh 2>/dev/null || true'
