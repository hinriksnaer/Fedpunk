#!/usr/bin/env fish
# Setup Bluetooth system for keyboards, mice, headsets, and other devices

source "$FEDPUNK_ROOT/lib/fish/ui.fish"

ui-info "Setting up Bluetooth support"

# Ensure Bluetooth service is enabled and running
if command -v bluetoothctl >/dev/null 2>&1
    ui-spin --title "Enabling Bluetooth service..." -- fish -c '
        sudo systemctl enable --now bluetooth.service >/dev/null 2>&1
    '

    if test $status -eq 0
        ui-success "Bluetooth service enabled and started"
    else
        ui-info "Bluetooth service already enabled"
    end

    # Check if Bluetooth hardware is available
    set -l bt_status (bluetoothctl show 2>/dev/null | grep -i "powered" | awk '{print $2}')
    if test "$bt_status" = "yes"
        ui-success "Bluetooth hardware detected and powered on"
    else if test -n "$bt_status"
        ui-warning "Bluetooth hardware detected but powered off - enable with 'bluetoothctl power on'"
    else
        ui-info "No Bluetooth hardware detected"
    end
else
    ui-warning "bluetoothctl command not found"
end

ui-success "Bluetooth setup complete"
ui-info "Use 'blueman-manager' for GUI or 'bluetoothctl' for CLI pairing"
