# Autostart Applications
# Programs to run on Hyprland startup
# Generated from chezmoi template with mode detection

# Essential services first
# Import all critical Wayland/toolkit environment variables into systemd user session
# This ensures systemd user services (like elephant, pipewire, mako) have proper Wayland support
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE XDG_SESSION_DESKTOP GDK_BACKEND QT_QPA_PLATFORM SDL_VIDEODRIVER CLUTTER_BACKEND MOZ_ENABLE_WAYLAND QT_AUTO_SCREEN_SCALE_FACTOR QT_WAYLAND_DISABLE_WINDOWDECORATION QT_QPA_PLATFORMTHEME GTK_THEME QT_STYLE_OVERRIDE
exec-once = hyprpolkitagent
# Mako notification daemon is managed by systemd (mako.service)

# Set dark mode preference for GTK/GNOME apps
exec-once = gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
exec-once = gsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'

# Wallpaper (hyprpaper reads from ~/.config/hypr/hyprpaper.conf)
# Theme switcher manages ~/.config/hypr/wallpapers/current symlink
exec-once = hyprpaper

# Network management
exec-once = nm-applet

{{- $mode := .mode.name }}
{{- if eq $mode "laptop" }}
# Laptop-specific: Battery and brightness management
# Power management applet
exec-once = xfce4-power-manager

# Brightness control notification (optional)
# exec-once = brightnessctl set 50%

# Auto-lock on low battery (optional)
# exec-once = bash -c 'while true; do battery=$(cat /sys/class/power_supply/BAT0/capacity); if [[ $battery -lt 10 ]]; then swaylock; fi; sleep 60; done'
{{- end }}

# Waybar status bar
exec-once = waybar

# Initialize default theme if none exists, then apply theme
exec-once = sleep 2 && bash -c 'if [[ ! -f ~/.config/kitty/theme.conf ]]; then ~/.local/bin/fedpunk-theme-set default 2>/dev/null || true; fi; ~/.local/bin/fedpunk-theme-refresh 2>/dev/null || true'

# Restore saved layout preference (after theme applies)
exec-once = sleep 3 && fish ~/.config/hypr/scripts/restore-layout.fish
