#!/usr/bin/env fish
# Fedpunk Reload Script
# Applies chezmoi changes and reloads all services

set fedpunk_dir "$HOME/.local/share/fedpunk"

echo "ğŸ”„ Fedpunk Reload"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Check for uncommitted changes
cd $fedpunk_dir
if test -n "$(git status --porcelain)"
    echo "âš ï¸  Warning: You have uncommitted changes in $fedpunk_dir"
    git status --short
    echo ""
end

# Apply chezmoi changes
echo "ğŸ“¦ Applying chezmoi..."
if chezmoi apply --source $fedpunk_dir
    echo "âœ“ Chezmoi applied successfully"
else
    echo "âœ— Chezmoi apply failed"
    exit 1
end

echo ""

# Reload Hyprland
echo "ğŸªŸ Reloading Hyprland..."
if hyprctl reload >/dev/null 2>&1
    echo "âœ“ Hyprland reloaded"
else
    echo "âœ— Hyprland reload failed (not running?)"
end

# Reload Waybar
echo "ğŸ“Š Reloading Waybar..."
if pkill -SIGUSR2 waybar
    echo "âœ“ Waybar reloaded"
else
    echo "âœ— Waybar reload failed (not running?)"
end

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ¨ Reload complete!"
