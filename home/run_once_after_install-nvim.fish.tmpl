#!/usr/bin/env fish
# Post-deployment: Setup Neovim lazy.nvim
# This runs after chezmoi applies configs, guaranteeing nvim config exists
# Note: Only runs if neovim is installed

# Ensure ~/.local/bin is in PATH for nvim AppImage
if not contains "$HOME/.local/bin" $PATH
    set -gx PATH "$HOME/.local/bin" $PATH
end

# Check if nvim is installed
if not command -v nvim >/dev/null 2>&1
    echo "ℹ neovim not installed, skipping plugin setup"
    exit 0
end

# Install lazy.nvim plugin manager
set lazy_path "$HOME/.local/share/nvim/lazy/lazy.nvim"

if not test -d "$lazy_path"
    echo "→ Installing lazy.nvim plugin manager..."
    git clone --filter=blob:none https://github.com/folke/lazy.nvim.git --branch=stable "$lazy_path"
    echo "✓ lazy.nvim installed"
else
    echo "✓ lazy.nvim already installed"
end

# Sync plugins (headless mode for automated setup)
if test -f "$HOME/.config/nvim/init.lua"
    echo "→ Installing Neovim plugins..."
    nvim --headless "+Lazy! sync" +qa
    echo "✓ Neovim plugins installed"
else
    echo "⚠ Neovim config not found, skipping plugin installation"
end
