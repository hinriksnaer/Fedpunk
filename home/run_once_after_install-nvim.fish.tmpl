#!/usr/bin/env fish
# Post-deployment: Setup Neovim lazy.nvim
# This runs after chezmoi applies configs, guaranteeing nvim config exists
# Note: Only runs if neovim is installed

# Check if nvim is installed
if not command -v nvim >/dev/null 2>&1
    echo "ℹ neovim not installed, skipping plugin setup"
    exit 0
end

echo ""
echo "Neovim Plugin Setup"
echo "==================="
echo ""

# Install lazy.nvim plugin manager
set lazy_path "$HOME/.local/share/nvim/lazy/lazy.nvim"

if not test -d "$lazy_path"
    gum spin --spinner dot --title "Installing lazy.nvim plugin manager..." -- \
        git clone --quiet --filter=blob:none https://github.com/folke/lazy.nvim.git --branch=stable "$lazy_path" 2>/dev/null
    echo "✓ lazy.nvim installed"
else
    echo "✓ lazy.nvim already installed"
end

# Sync plugins (headless mode for automated setup)
if test -f "$HOME/.config/nvim/init.lua"
    gum spin --spinner dot --title "Installing Neovim plugins..." -- \
        nvim --headless "+Lazy! sync" +qa 2>/dev/null
    echo "✓ Neovim plugins installed"
else
    echo "⚠ Neovim config not found, skipping plugin installation"
end

echo ""
